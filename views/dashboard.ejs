<%- include("templates/header.ejs") %>
<body class="dashboard-page">
  <div class="sidebar" id="sidebar">
    <div class="brand">
      <h2>Gestor de inventarios</h2>
    </div>
    <nav>
      <ul>
        <li style="color: var(--muted); font-size: 0.9rem; margin-bottom: 8px; padding: 0 16px;">Navegación principal</li>
        <li><a href="#overview">Dashboard</a></li>
        <li><a href="#clientes">Clientes</a></li>
        <li><a href="#productos">Gestión de productos</a></li>
        <!-- <li><a href="#usuarios">Gestión de usuarios</a></li>
        <li><a href="#reportes">Reportes</a></li> -->
        
        <li style="color: var(--muted); font-size: 0.9rem; margin: 24px 0 8px; padding: 0 16px;">Configuración</li>
        <li><a href="/qr">¡Escanéame!</a></li>
        <li><a href="/salir" id="logoutBtn">Salir</a></li>
      </ul>
    </nav>
  </div>

  <div class="main-content" id="mainContent">
    <header class="topbar">
      <h1>Usuario</h1>
    </header>

    <section id="overview" class="section">
      <div class="cards">
        <div class="card stat">
          <h3>Clientes</h3>
          <p id=""><%= nCli %></p>
        </div>
        <div class="card stat">
          <h3>Existencia total</h3>
          <p id="statStockVal">
            <%= exTot %>
          </p>
        </div>
        <div class="card stat">
          <h3>Proveedores</h3>
          <p>
            <%= nProv %>
          </p>
        </div>
      </div>

      <div class="cards">
        <div class="card stat">
          <h3>Productos</h3>
          <p id="statProductsVal">
            <%= nPro %>
          </p>
        </div>
      </div>
    </section>

    <section id="clientes" class="section">
      <h2>Clientes</h2>
      <div class="card">
        <div class="table-actions">
          <form action="/bsCli" method="post" style="margin-right: 10px;">
            <input type="text" placeholder="Buscar" id="bsClie" name="bsClie" >
          </form>
          <a href="/nCli" class="btn primary">+ Cliente</a>
        </div>
        <table class="table">
          <thead>
            <tr><th>Nombre</th><th>Correo</th><th>Teléfono</th><th>Editar / Borrar</th></tr>
          </thead>
          <tbody id="clientsTableBody">
            <% 
              clientes.forEach((cliente)=>{
            %>
              <tr>
                <td>
                  <%= cliente.nombre %>
                </td>
                <td>
                  <%= cliente.correo %>
                </td>
                <td>
                  <%= cliente.telefono %>
                </td>
                <td>
                  <a href="/editarCliente/<%= cliente._id %>">Editar</a> / <a href="/borrarCliente/<%= cliente._id %>">Borrar</a>
                </td>
              </tr>
            <%
              })
            %>
          </tbody>
        </table>
      </div>
    </section>

    <section id="productos" class="section">
      <h2>Gestión de productos</h2>
      <div class="card">
        <div class="table-actions">
          <form action="/bsPro" method="post" style="margin-right: 10px;">
            <input type="text" placeholder="Buscar" id="bsPro" name="bsPro" >
          </form>
          <a href="/nPro" class="btn primary">+ Producto</a>
        </div>
        <table class="table">
          <thead>
            <tr><th>Id</th><th>Foto</th><th>Producto</th><th>Categoría</th><th>Existencia</th><th>Proveedor</th><th>Editar / Borrar</th></tr>
          </thead>
          <tbody id="productsTableBody">
            <% 
              productos.forEach((product)=>{
            %>
              <tr>
                <td>
                  <%= product._id %>
                </td>
                <td>
                  <img src="images/<%= product.imagen %>" alt="<%= product.producto %>" width="50px">
                </td>
                <td>
                  <%= product.producto %>
                </td>
                <td>
                  <%= product.categoria %>
                </td>
                <td>
                  <%= product.existencia %>
                </td>
                <td>
                  <%= product.proveedor %>
                </td>
                <td>
                  <a href="/editarProducto/<%= product._id %>">Editar</a> / <a href="/borrarProducto/<%= product._id %>">Borrar</a>
                </td>
              </tr>
            <%
              })
            %>
          </tbody>
        </table>
      </div>
    </section>
    <section id="ventas" class="section">
      <h2>Gestión de Ventas</h2>
      <div class="card">
        <div class="table-actions">
          <form action="/bsVen" method="post" style="margin-right: 10px;">
            <input type="text" placeholder="Buscar" id="bsVen" name="bsVen" >
          </form>
          <a href="/nVen" class="btn primary">+ Venta</a>
        </div>
        <table class="table">
          <thead>
            <tr><th>Producto</th><th>Cliente</th><th>Cantidad</th><th>Editar / Borrar</th></tr>
          </thead>
          <tbody id="sellsTableBody">
            <% 
              ventas.forEach((venta)=>{
            %>
              <tr>
                <td>
                  <%= venta.nomPro %>
                </td>
                <td>
                  <%= venta.nomCli %>
                </td>
                <td>
                  <%= venta.cantidad %>
                </td>
                <td>
                  <a href="/editarVenta/<%= venta._id %>">Editar</a> / <a href="/borrarVenta/<%= venta._id %>">Borrar</a>
                </td>
              </tr>
            <%
              })
            %>
          </tbody>
        </table>
      </div>
    </section>

    <section id="usuarios" class="section">
      <h2>Usuarios</h2>
      <div class="card">
        <div class="table-actions">
          <form action="/bsUser" method="post">
            <input type="text" placeholder="Buscar" id="bsUser" name="bsUser" >
          </form>
        </div>
        <table class="table">
          <thead>
            <tr><th>Nombre</th><th>Correo</th><th>Categoría</th><th>Cambiar / Borrar</th></tr>
          </thead>
          <tbody id="usuariosTableBody">
            <% 
              usuarios.forEach((usuario)=>{
            %>
              <tr>
                <td>
                  <%= usuario.nombre %>
                </td>
                <td>
                  <%= usuario.correo %>
                </td>
                <td>
                  <%if(usuario.categoria == 2){%>
                    Normal
                  <%}else{%>
                    Administrador
                  <%} %>
                </td>
                <td>
                  <a href="/cambiarUS/<%= usuario._id %>">Cambiar</a> / <a href="/borrarUsuario/<%= usuario._id %>">Borrar</a>
                </td>
              </tr>
            <%
              })
            %>
          </tbody>
        </table>
      </div>
    </section>
    <footer class="small muted">Sistema de Control de Inventarios v2.0</footer>
  </div>
<%- include("templates/footer.ejs") %>